<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

<div class="curso-list-bg-gradient vh-100 w-100 position-fixed top-0 start-0"></div>

<div class="position-fixed top-0 end-0 p-3 z-3">
  <img src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/icons/person-circle.svg"
       alt="Perfil"
       class="rounded-circle border border-2 border-primary bg-white shadow-sm"
       style="width: 54px; height: 54px; cursor: pointer; object-fit: cover; transition: box-shadow 0.2s;"
       (click)="irPerfil()"
       title="Ver perfil"/>
</div>

<div *ngIf="loadingCurso" class="curso-list-loading-overlay d-flex flex-column justify-content-center align-items-center">
  <div class="curso-list-spinner"></div>
  <span class="mt-3 text-primary fw-bold fs-5">Cargando curso...</span>
</div>

<div class="container-fluid min-vh-100 d-flex flex-column align-items-center justify-content-center position-relative px-0">
  <div class="curso-list-notch-spacer"></div>
  <div class="w-100 mb-4" style="max-width: 900px;">
    <div class="text-center animated-fadeInUp">
      <i class="bi bi-journal-code text-primary" style="font-size: 2.7rem;"></i>
      <h2 class="fw-bold mt-2 mb-0">Cursos <span class="text-primary">STEAM</span></h2>
      <p class="text-secondary mb-0">Explora Ciencia, Tecnología, Ingeniería, Artes y Matemáticas</p>
    </div>
  </div>

  <div class="row w-100 g-4 justify-content-center mb-5" style="max-width: 900px;">
    <div class="col-12 col-sm-6 col-lg-3 d-flex animated-fadeInUp" *ngFor="let curso of cursosColor">
      <div class="curso-card h-100 w-100 position-relative" [ngClass]="curso.bgClass">
        <div class="card-body d-flex flex-column align-items-center text-center p-4">
          <div class="curso-icono mb-2" [ngClass]="curso.textClass">
            <i [ngClass]="curso.icono"></i>
          </div>
          <h5 class="card-title fw-bold mb-1" [ngClass]="curso.textClass">{{ curso.titulo }}</h5>
          <p class="card-text text-secondary mb-3">{{ curso.descripcion }}</p>
          <button class="mt-auto btn curso-btn-anim w-100 d-flex align-items-center justify-content-center gap-2"
                  [ngClass]="curso.btnClass"
                  [disabled]="loadingCurso === curso.id"
                  (click)="irCurso(curso.id)">
            <span *ngIf="loadingCurso === curso.id" class="spinner-border spinner-border-sm me-2"></span>
            <i class="bi bi-box-arrow-in-right"></i> Ir al curso
          </button>
        </div>
      </div>
    </div>
  </div>
  <div class="curso-list-navbar-spacer"></div>
</div>

<!-- Modal responsivo para actividades -->
<div *ngIf="mostrarModal" class="modal-overlay position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center" style="background-color: rgba(0,0,0,0.5); z-index: 1050;">
  <div class="modal-content bg-white rounded shadow-lg position-relative" style="max-width: 96vw; max-height: 96vh; width: 1000px;">
    
    <!-- Botón cerrar inteligente -->
    <div class="position-absolute top-0 end-0 m-3" style="z-index: 10;">
      <button *ngIf="actividadActiva" class="btn btn-outline-secondary btn-sm" (click)="cerrarTodoModal()" title="Cerrar todo">
        <i class="bi bi-x-lg"></i>
      </button>
      <button *ngIf="!actividadActiva" class="btn-close" (click)="cerrarModal()" title="Cerrar"></button>
    </div>
    
    <!-- Lista de actividades mejorada -->
    <div *ngIf="!actividadActiva" class="d-flex flex-column h-100">
      <!-- Header del curso fijo -->
      <div class="flex-shrink-0 p-4 p-md-5 pb-3">
        <div class="text-center mb-4">
          <div class="mb-3">
            <i class="bi bi-journal-bookmark-fill text-primary" style="font-size: 3rem;"></i>
          </div>
          <h2 class="fw-bold text-primary mb-2">{{ cursoSeleccionado?.titulo }}</h2>
          <p class="text-muted fs-5 mb-3">{{ cursoSeleccionado?.descripcion }}</p>
          <div class="d-flex justify-content-center gap-3">
            <span class="badge bg-primary fs-6 px-3 py-2">
              <i class="bi bi-list-task me-2"></i>{{ cursoSeleccionado?.actividades?.length }} Actividades
            </span>
            <span class="badge bg-success fs-6 px-3 py-2">
              <i class="bi bi-clock me-2"></i>Aprende a tu ritmo
            </span>
          </div>
        </div>
      </div>
      
      <!-- Grid de actividades con scroll -->
      <div class="flex-grow-1 overflow-auto px-4 px-md-5">
        <div class="container-fluid px-0">
          <div class="row g-3">
            <div *ngFor="let actividad of cursoSeleccionado?.actividades; let i = index" 
                 class="col-12">
              <div class="actividad-card-enhanced card border-0 shadow-sm h-100"
                   style="cursor: pointer; transition: all 0.3s ease; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);"
                   (click)="iniciarActividad(actividad)">
                <div class="card-body p-4">
                  <div class="d-flex align-items-start">
                    <div class="me-4 flex-shrink-0">
                      <div class="actividad-icon-circle rounded-circle d-flex align-items-center justify-content-center" 
                           [style.background]="actividad.tipo === 'lectura' ? 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' : 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)'"
                           style="width: 60px; height: 60px;">
                        <i [class]="actividad.tipo === 'lectura' ? 'bi bi-book text-white fs-3' : 'bi bi-patch-question-fill text-white fs-3'"></i>
                      </div>
                      <div class="text-center mt-2">
                        <small class="badge" 
                              [class]="actividad.tipo === 'lectura' ? 'bg-primary' : 'bg-warning text-dark'">
                          {{ i + 1 }}
                        </small>
                      </div>
                    </div>
                    <div class="flex-grow-1">
                      <h4 class="fw-bold text-dark mb-2">{{ actividad.titulo }}</h4>
                      <p class="text-muted mb-3" style="line-height: 1.6;">{{ actividad.descripcion }}</p>
                      <div class="d-flex align-items-center justify-content-between">
                        <span class="badge fs-6 px-3 py-2" 
                              [class]="actividad.tipo === 'lectura' ? 'bg-primary bg-opacity-10 text-primary' : 'bg-warning bg-opacity-10 text-warning'">
                          <i [class]="actividad.tipo === 'lectura' ? 'bi bi-book me-2' : 'bi bi-patch-question me-2'"></i>
                          {{ actividad.tipo === 'lectura' ? 'Lectura' : 'Evaluación' }}
                          <span *ngIf="actividad.tipo === 'preguntas'" class="ms-1">
                            ({{ actividad.preguntas?.length || 0 }} preguntas)
                          </span>
                        </span>
                        <div class="actividad-arrow">
                          <i class="bi bi-arrow-right-circle text-primary fs-4"></i>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Footer informativo fijo -->
      <div class="flex-shrink-0 text-center py-4 px-4 px-md-5 border-top">
        <p class="text-muted mb-0">
          <i class="bi bi-lightbulb me-2"></i>
          Completa todas las actividades para dominar este tema
        </p>
      </div>
    </div>    <!-- Contenido de actividad específica -->
    <div *ngIf="actividadActiva" class="d-flex flex-column h-100">
      <!-- Header de actividad mejorado con navegación -->
      <div class="bg-light border-bottom p-3 flex-shrink-0">
        <div class="d-flex align-items-center justify-content-between">
          <div class="d-flex align-items-center flex-grow-1">
            <button class="btn btn-outline-primary btn-sm me-3 d-flex align-items-center" (click)="mostrarListaActividades()" title="Volver a actividades">
              <i class="bi bi-arrow-left me-2"></i>
              <span class="d-none d-sm-inline">Volver</span>
            </button>
            <div class="flex-grow-1 me-3">
              <h5 class="mb-0 fw-bold">{{ actividadActiva.titulo }}</h5>
              <small class="text-muted">{{ actividadActiva.descripcion }}</small>
            </div>
            <span class="badge me-4" [class]="actividadActiva.tipo === 'lectura' ? 'bg-primary' : 'bg-warning text-dark'">
              <i [class]="actividadActiva.tipo === 'lectura' ? 'bi bi-book me-1' : 'bi bi-patch-question me-1'"></i>
              {{ actividadActiva.tipo | titlecase }}
            </span>
          </div>
        </div>
      </div>
      
      <!-- Contenido principal -->
      <div class="flex-grow-1 overflow-auto">
        
        <!-- Actividad de lectura completamente responsiva -->
        <div *ngIf="actividadActiva.tipo === 'lectura'" class="h-100 d-flex flex-column">
          <div class="flex-grow-1 p-3 p-md-4">
            <div class="container-fluid">
              <div class="row justify-content-center">
                <div class="col-12 col-lg-10 col-xl-8">
                  <article class="lectura-article">
                    <div [innerHTML]="actividadActiva.contenido" class="content-html"></div>
                  </article>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Botón fijo responsive con padding para navbar -->
          <div class="border-top bg-white p-3 flex-shrink-0" style="padding-bottom: 100px !important;">
            <div class="container-fluid">
              <div class="row justify-content-center">
                <div class="col-12 col-md-8 col-lg-6">
                  <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                    <button class="btn btn-success btn-lg flex-fill flex-md-grow-0 px-4" (click)="mostrarListaActividades()">
                      <i class="bi bi-check-circle me-2"></i>Completar Lectura
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Actividad de preguntas responsiva -->
        <div *ngIf="actividadActiva.tipo === 'preguntas' && !mostrarResultados" class="h-100 d-flex flex-column">
          <div class="flex-grow-1 p-3 p-md-4 overflow-auto">
            <div class="container-fluid">
              <div class="row justify-content-center">
                <div class="col-12 col-lg-10 col-xl-8">
                  
                  <!-- Barra de progreso -->
                  <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body">
                      <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="mb-0 fw-bold">Progreso de la Evaluación</h6>
                        <span class="badge bg-primary fs-6">
                          {{ getRespuestasCompletadas() }} / {{ actividadActiva.preguntas.length }}
                        </span>
                      </div>
                      <div class="progress mb-2" style="height: 8px;">
                        <div class="progress-bar bg-primary" 
                             [style.width.%]="(getRespuestasCompletadas() / actividadActiva.preguntas.length) * 100">
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Preguntas -->
                  <div *ngFor="let pregunta of actividadActiva.preguntas; let i = index" class="card border-0 shadow-sm mb-4">
                    <div class="card-header bg-primary bg-opacity-10 border-0">
                      <div class="d-flex align-items-center">
                        <span class="badge bg-primary me-2 fs-6">{{ i + 1 }}</span>
                        <h6 class="fw-bold mb-0 text-dark">{{ pregunta.pregunta }}</h6>
                      </div>
                    </div>
                    <div class="card-body p-3">
                      <div class="options">
                        <div *ngFor="let opcion of pregunta.opciones; let j = index" 
                             class="form-check p-3 mb-2 border rounded"
                             [class.border-primary]="respuestas[i] === j"
                             [class.bg-primary]="respuestas[i] === j"
                             [class.bg-opacity-10]="respuestas[i] === j"
                             style="cursor: pointer; transition: all 0.2s ease;">
                          <input class="form-check-input" 
                                 type="radio" 
                                 [name]="'pregunta' + i" 
                                 [id]="'modal-opcion' + i + '-' + j"
                                 [checked]="respuestas[i] === j"
                                 (change)="seleccionarRespuesta(i, j)"
                                 style="margin-top: 0.25rem;">
                          <label class="form-check-label w-100" 
                                 [for]="'modal-opcion' + i + '-' + j"
                                 [class.fw-bold]="respuestas[i] === j"
                                 [class.text-primary]="respuestas[i] === j"
                                 style="cursor: pointer; line-height: 1.5;">
                            {{ opcion }}
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Botón finalizar fijo responsive con padding para navbar -->
          <div class="border-top bg-white p-3 flex-shrink-0" style="padding-bottom: 100px !important;">
            <div class="container-fluid">
              <div class="row justify-content-center">
                <div class="col-12 col-md-8 col-lg-6">
                  <div class="d-grid">
                    <button class="btn btn-primary btn-lg" 
                            (click)="finalizarEvaluacion()"
                            [disabled]="getRespuestasCompletadas() < actividadActiva.preguntas.length">
                      <i class="bi bi-check-square me-2"></i>
                      Finalizar Evaluación
                      <span class="badge bg-white text-primary ms-2">
                        {{ getRespuestasCompletadas() }}/{{ actividadActiva.preguntas.length }}
                      </span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
        
        <!-- Resultados responsivos -->
        <div *ngIf="mostrarResultados" class="h-100 d-flex flex-column">
          <div class="flex-grow-1 p-3 p-md-4 overflow-auto">
            <div class="container-fluid">
              <div class="row justify-content-center">
                <div class="col-12 col-lg-10 col-xl-8">
                  
                  <!-- Tarjeta de puntuación -->
                  <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body text-center p-4">
                      <div [class]="esAprobado() ? 'text-success' : 'text-warning'">
                        <i [class]="esAprobado() ? 'bi bi-check-circle-fill' : 'bi bi-exclamation-triangle-fill'" 
                           class="display-4"></i>
                      </div>
                      <h3 class="mt-3 mb-2 fw-bold">{{ esAprobado() ? '¡Excelente trabajo!' : '¡Sigue practicando!' }}</h3>
                      <h5 class="text-muted mb-4">{{ aciertos }} de {{ actividadActiva.preguntas.length }} respuestas correctas</h5>
                      <div class="progress mb-3" style="height: 25px;">
                        <div class="progress-bar" 
                             [class]="esAprobado() ? 'bg-success' : 'bg-warning'"
                             [style.width.%]="getPorcentajeAciertos()">
                          <span class="fw-bold">{{ getPorcentajeAciertos() | number:'1.0-0' }}%</span>
                        </div>
                      </div>
                      <div class="alert" [class]="esAprobado() ? 'alert-success' : 'alert-warning'">
                        <i [class]="esAprobado() ? 'bi bi-check-circle me-2' : 'bi bi-info-circle me-2'"></i>
                        {{ esAprobado() ? 'Has aprobado la evaluación' : 'Necesitas 70% para aprobar' }}
                      </div>
                    </div>
                  </div>
                  
                                    <!-- Revisión de respuestas -->
                  <div class="card border-0 shadow-sm mb-4">
                    <div class="card-header bg-light border-0">
                      <h5 class="mb-0 fw-bold">
                        <i class="bi bi-clipboard-check me-2"></i>Revisión de respuestas
                      </h5>
                    </div>
                    <div class="card-body p-0">
                      <div *ngFor="let pregunta of actividadActiva.preguntas; let i = index" 
                           class="border-bottom p-3 p-md-4">
                        <div class="d-flex align-items-start">
                          <div class="me-3 flex-shrink-0">
                            <i [class]="respuestas[i] === pregunta.respuestaCorrecta ? 'bi bi-check-circle-fill text-success' : 'bi bi-x-circle-fill text-danger'" 
                               class="fs-4"></i>
                          </div>
                          <div class="flex-grow-1">
                            <div class="d-flex align-items-center mb-2">
                              <span class="badge bg-dark me-2">{{ i + 1 }}</span>
                              <h6 class="mb-0 fw-bold">{{ pregunta.pregunta }}</h6>
                            </div>
                            
                            <div class="row g-2 mb-3">
                              <div class="col-12 col-md-6">
                                <div class="card border-0 h-100" 
                                     [class.bg-danger]="respuestas[i] !== pregunta.respuestaCorrecta"
                                     [class.bg-opacity-10]="respuestas[i] !== pregunta.respuestaCorrecta">
                                  <div class="card-body p-3">
                                    <h6 class="card-title text-muted mb-2 small">
                                      <i class="bi bi-person me-1"></i>Tu respuesta:
                                    </h6>
                                    <p class="card-text fw-bold small" 
                                       [class.text-danger]="respuestas[i] !== pregunta.respuestaCorrecta">
                                      {{ pregunta.opciones[respuestas[i]] || 'Sin respuesta' }}
                                    </p>
                                  </div>
                                </div>
                              </div>
                              <div class="col-12 col-md-6">
                                <div class="card border-0 bg-success bg-opacity-10 h-100">
                                  <div class="card-body p-3">
                                    <h6 class="card-title text-muted mb-2 small">
                                      <i class="bi bi-check-circle me-1"></i>Correcta:
                                    </h6>
                                    <p class="card-text fw-bold text-success small">
                                      {{ pregunta.opciones[pregunta.respuestaCorrecta] }}
                                    </p>
                                  </div>
                                </div>
                              </div>
                            </div>
                            
                            <div class="alert alert-info mb-0">
                              <small><i class="bi bi-lightbulb me-1"></i><strong>Explicación:</strong> {{ pregunta.explicacion }}</small>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Botones finales responsive con padding para navbar -->
          <div class="border-top bg-white p-3 flex-shrink-0" style="padding-bottom: 100px !important;">
            <div class="container-fluid">
              <div class="row justify-content-center">
                <div class="col-12 col-md-8 col-lg-6">
                  <div class="d-flex gap-2 flex-column flex-sm-row">
                    <button class="btn btn-outline-primary btn-lg flex-fill" (click)="reiniciarEvaluacion()">
                      <i class="bi bi-arrow-clockwise me-2"></i>Intentar de nuevo
                    </button>
                    <button class="btn btn-success btn-lg flex-fill" (click)="mostrarListaActividades()">
                      <i class="bi bi-list me-2"></i>Ver más actividades
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<style>
.content-html h2 {
  color: #0d6efd;
  margin-top: 1.5rem;
  margin-bottom: 1rem;
  font-size: 1.5rem;
}

.content-html h3 {
  color: #6f42c1;
  margin-top: 1.2rem;
  margin-bottom: 0.8rem;
  font-size: 1.25rem;
}

.content-html p {
  line-height: 1.6;
  margin-bottom: 1rem;
  font-size: 1rem;
}

.content-html ul {
  margin-left: 1.2rem;
  margin-bottom: 1rem;
}

.content-html li {
  margin-bottom: 0.5rem;
  line-height: 1.5;
}

.content-html strong {
  color: #495057;
}

/* Artículo de lectura responsive */
.lectura-article {
  background: white;
  border-radius: 8px;
  padding: 1.5rem;
  box-shadow: 0 2px 10px rgba(0,0,0,0.05);
  border: 1px solid #e9ecef;
}

.modal-overlay {
  backdrop-filter: blur(5px);
}

.modal-content {
  animation: fadeInScale 0.3s ease-out;
  height: 95vh;
  overflow: hidden;
}

@keyframes fadeInScale {
  from {
    opacity: 0;
    transform: scale(0.9);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

.actividad-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
}

.actividad-card-enhanced:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
  background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%) !important;
}

.actividad-card-enhanced:hover .actividad-arrow {
  transform: translateX(5px);
}

.actividad-arrow {
  transition: transform 0.3s ease;
}

.actividad-icon-circle {
  box-shadow: 0 4px 15px rgba(0,0,0,0.2);
}

.options .form-check-label {
  cursor: pointer;
}

.options .form-check:hover {
  background-color: #f8f9fa !important;
  border-color: #0d6efd !important;
}

/* Mejoras responsivas y espaciado para navbar */
@media (max-width: 768px) {
  .modal-content {
    max-width: 100vw !important;
    max-height: 100vh !important;
    height: 100vh !important;
    border-radius: 0 !important;
    margin: 0;
  }
  
  .actividad-card-enhanced .card-body {
    padding: 1.5rem !important;
  }
  
  .actividad-card-enhanced h4 {
    font-size: 1.2rem;
  }
  
  .actividad-icon-circle {
    width: 50px !important;
    height: 50px !important;
  }
  
  .actividad-icon-circle i {
    font-size: 1.2rem !important;
  }
  
  .lectura-article {
    padding: 1rem;
  }
  
  .content-html h2 {
    font-size: 1.3rem;
  }
  
  .content-html h3 {
    font-size: 1.1rem;
  }
  
  .content-html p,
  .content-html li {
    font-size: 0.95rem;
  }
  
  .card-body {
    padding: 1rem !important;
  }
  
  .container-fluid {
    padding-left: 0.75rem;
    padding-right: 0.75rem;
  }

  /* Espaciado adicional en móvil para navbar */
  .border-top[style*="padding-bottom"] {
    padding-bottom: 120px !important;
  }
}

@media (max-width: 576px) {
  .lectura-article {
    padding: 0.75rem;
  }
  
  .content-html h2 {
    font-size: 1.2rem;
    margin-top: 1rem;
  }
  
  .content-html h3 {
    font-size: 1.05rem;
    margin-top: 0.8rem;
  }
  
  .content-html p,
  .content-html li {
    font-size: 0.9rem;
    line-height: 1.5;
  }
  
  .content-html ul {
    margin-left: 1rem;
  }
}

/* Scrollbar personalizada */
.overflow-auto::-webkit-scrollbar {
  width: 6px;
}

.overflow-auto::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 3px;
}

.overflow-auto::-webkit-scrollbar-thumb {
  background: #c1c1c1;
  border-radius: 3px;
}

.overflow-auto::-webkit-scrollbar-thumb:hover {
  background: #a8a8a8;
}

/* Scroll suave en todos los navegadores */
.overflow-auto {
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch; /* Scroll suave en iOS */
}

/* Mejora para scroll en móvil */
@media (max-width: 768px) {
  .overflow-auto {
    /* Mejor experiencia de scroll en móvil */
    overscroll-behavior: contain;
  }
}
</style>
