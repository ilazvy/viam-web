<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

<div class="register-bg-gradient vh-100 w-100 position-fixed top-0 start-0"></div>
<div class="position-absolute top-0 start-0 p-3 z-3">
  <div class="register-back-btn d-flex align-items-center gap-2" (click)="volver()" title="Volver">
    <i class="bi bi-arrow-left-circle-fill fs-2 text-primary animated-bounce"></i>
    <span class="fw-semibold text-primary d-none d-md-inline">Volver</span>
  </div>
</div>

<div class="container d-flex justify-content-center align-items-center vh-100 position-relative z-2">
  <div *ngIf="loading" class="register-loading-overlay d-flex flex-column justify-content-center align-items-center">
    <div class="register-spinner"></div>
    <span class="mt-3 text-primary fw-bold fs-5">Creando tu cuenta...</span>
  </div>
  <div class="register-card animated-fadeInUp">
    <div class="text-center mb-4">
      <div class="register-avatar mx-auto mb-2 animated-pop">
        <i class="bi bi-person-plus-fill text-primary"></i>
      </div>
      <h2 class="mt-2 mb-0 fw-bold">Registro</h2>
      <p class="text-secondary mb-0">Crea tu cuenta en <span class="fw-bold text-primary">Viam</span></p>
    </div>
    <form [formGroup]="formularioRegistro" (ngSubmit)="registrar()" novalidate autocomplete="off">
      <div class="mb-3">
        <label for="nombre" class="form-label">Nombre completo</label>
        <div class="input-group has-validation">
          <span class="input-group-text"><i class="bi bi-person"></i></span>
          <input id="nombre" type="text" class="form-control"
                 formControlName="nombre"
                 pattern="^[A-Za-zÁÉÍÓÚáéíóúÑñÜü\s]+$"
                 [class.is-invalid]="formularioRegistro.get('nombre')?.invalid && (formularioRegistro.get('nombre')?.touched || formularioRegistro.get('nombre')?.dirty)" />
          <div class="invalid-feedback"
               *ngIf="formularioRegistro.get('nombre')?.errors && (formularioRegistro.get('nombre')?.touched || formularioRegistro.get('nombre')?.dirty)">
            <span *ngIf="formularioRegistro.get('nombre')?.errors?.['required']">El nombre es obligatorio.</span>
            <span *ngIf="formularioRegistro.get('nombre')?.errors?.['pattern']">Solo letras y espacios, sin números ni caracteres especiales.</span>
          </div>
        </div>
      </div>

      <div class="mb-3">
        <label for="email" class="form-label">Correo electrónico</label>
        <div class="input-group has-validation">
          <span class="input-group-text"><i class="bi bi-envelope"></i></span>
          <input id="email" type="email" class="form-control"
                 formControlName="email"
                 [pattern]="'^[A-Za-z0-9._%+-]+@(gmail\\.com|utcv\\.edu\\.mx)$'"
                 [class.is-invalid]="formularioRegistro.get('email')?.invalid && (formularioRegistro.get('email')?.touched || formularioRegistro.get('email')?.dirty)" />
          <div class="invalid-feedback"
               *ngIf="formularioRegistro.get('email')?.errors && (formularioRegistro.get('email')?.touched || formularioRegistro.get('email')?.dirty)">
            <span *ngIf="formularioRegistro.get('email')?.errors?.['required']">El correo es obligatorio.</span>
            <span *ngIf="formularioRegistro.get('email')?.errors?.['pattern']">Agrega un correo electrónico válido.</span>
          </div>
        </div>
      </div>

      <!-- Contraseña con botón de mostrar/ocultar -->
      <div class="mb-3">
        <label for="password" class="form-label">Contraseña</label>
        <div class="input-group has-validation flex-nowrap register-password-group">
          <span class="input-group-text"><i class="bi bi-lock"></i></span>
          <input id="password" [type]="mostrarPassword ? 'text' : 'password'" class="form-control register-password-input"
                 formControlName="password"
                 [class.is-invalid]="formularioRegistro.get('password')?.invalid && (formularioRegistro.get('password')?.touched || formularioRegistro.get('password')?.dirty)"
                 style="min-width:0;" />
          <button type="button" class="btn btn-outline-secondary register-password-btn" tabindex="-1" (click)="mostrarPassword = !mostrarPassword" [attr.aria-label]="mostrarPassword ? 'Ocultar contraseña' : 'Mostrar contraseña'">
            <i class="bi" [ngClass]="mostrarPassword ? 'bi-eye-slash' : 'bi-eye'"></i>
          </button>
        </div>
        <div class="invalid-feedback"
             *ngIf="formularioRegistro.get('password')?.errors && (formularioRegistro.get('password')?.touched || formularioRegistro.get('password')?.dirty)">
          <span *ngIf="formularioRegistro.get('password')?.errors?.['required']">La contraseña es obligatoria.</span>
          <span *ngIf="formularioRegistro.get('password')?.errors?.['minlength']">Mínimo 6 caracteres.</span>
        </div>
      </div>

      <button type="submit" class="btn btn-primary btn-lg w-100 d-flex align-items-center justify-content-center gap-2 animated-btn register-btn-gradient" [disabled]="loading">
        <i class="bi bi-person-plus"></i> Registrarse
      </button>

      <div *ngIf="errorMsg" class="alert alert-danger mt-3 text-center">
        {{ errorMsg }}
      </div>
    </form>

    <!-- Verificación de correo -->
    <!-- <app-verificar-correo
      *ngIf="mostrarVerificacion && usuarioIdRegistrado"
      [usuarioId]="usuarioIdRegistrado"
      (verificado)="onCorreoVerificado($event)">
    </app-verificar-correo>

    <div *ngIf="registroExitoso && !mostrarVerificacion" class="alert alert-success mt-4 text-center">
      ¡Registro exitoso! Ahora puedes iniciar sesión.
    </div> -->
  </div>
</div>
