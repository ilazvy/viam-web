<!-- Enlaces Bootstrap y Bootstrap Icons (mantener solo si es necesario en este componente, pero lo ideal es en index.html) -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

<div class="login-bg-gradient vh-100 w-100 position-fixed top-0 start-0"></div>
<div class="position-absolute top-0 start-0 p-3 z-3">
  <div class="login-back-btn d-flex align-items-center gap-2" (click)="volver()" title="Volver">
    <i class="bi bi-arrow-left-circle-fill fs-2 text-primary animated-bounce"></i>
    <span class="fw-semibold text-primary d-none d-md-inline">Volver</span>
  </div>
</div>

<div class="container d-flex justify-content-center align-items-center vh-100 position-relative z-2">
  <div *ngIf="loading" class="login-loading-overlay d-flex flex-column justify-content-center align-items-center">
    <div class="login-spinner"></div>
    <span class="mt-3 text-primary fw-bold fs-5">Iniciando sesión...</span>
  </div>
  <div class="login-card animated-fadeInUp position-relative">
    <div class="text-center mb-4 mt-3">
      <div class="login-avatar mx-auto mb-2 animated-pop">
        <i class="bi bi-person-circle text-primary"></i>
      </div>
      <h2 class="mt-2 mb-0 fw-bold">Iniciar Sesión</h2>
      <p class="text-secondary mb-0">Accede a tu cuenta de <span class="fw-bold text-primary">Viam</span></p>
    </div>

    <form (ngSubmit)="iniciarSesion()" [formGroup]="formularioLogin" novalidate autocomplete="off">
      <div class="mb-3">
        <label for="email" class="form-label">Email</label>
        <div class="input-group has-validation">
          <span class="input-group-text"><i class="bi bi-envelope"></i></span>
          <input id="email" type="email" formControlName="email" class="form-control"
            [pattern]="'^[A-Za-z0-9._%+-]+@(gmail\\.com|utcv\\.edu\\.mx)$'"
            [class.is-invalid]="formularioLogin.get('email')?.invalid && (formularioLogin.get('email')?.touched || formularioLogin.get('email')?.dirty)"
            required autocomplete="username" />
          <div class="invalid-feedback"
            *ngIf="formularioLogin.get('email')?.errors && (formularioLogin.get('email')?.touched || formularioLogin.get('email')?.dirty)">
            <span *ngIf="formularioLogin.get('email')?.errors?.['required']">El email es requerido.</span>
            <span *ngIf="formularioLogin.get('email')?.errors?.['pattern']">Solo se permiten correos &#64;gmail.com o
              &#64;utcv.edu.mx.</span>
          </div>
        </div>
      </div>

      <!-- Contraseña con botón de mostrar/ocultar -->
      <div class="mb-4">
        <label for="password" class="form-label">Contraseña</label>
        <div class="form-group">
        <div class="input-group has-validation flex-nowrap login-password-group">
          <span class="input-group-text"><i class="bi bi-lock"></i></span>
          <input id="password" [type]="mostrarPassword ? 'text' : 'password'" class="form-control login-password-input"
                 formControlName="password"
                 [class.is-invalid]="formularioLogin.get('password')?.invalid && (formularioLogin.get('password')?.touched || formularioLogin.get('password')?.dirty)"
                 required autocomplete="current-password" />
          <button type="button" class="btn btn-outline-secondary login-password-btn" tabindex="-1"
                  (click)="mostrarPassword = !mostrarPassword"
                  [attr.aria-label]="mostrarPassword ? 'Ocultar contraseña' : 'Mostrar contraseña'">
            <i class="bi" [ngClass]="mostrarPassword ? 'bi-eye-slash' : 'bi-eye'"></i>
          </button>
        </div>
        <div class="invalid-feedback"
             *ngIf="formularioLogin.get('password')?.errors && (formularioLogin.get('password')?.touched || formularioLogin.get('password')?.dirty)">
          <span *ngIf="formularioLogin.get('password')?.errors?.['required']">La contraseña es requerida.</span>
          <span *ngIf="formularioLogin.get('password')?.errors?.['minlength']">La contraseña debe tener al menos 6 caracteres.</span>
        </div>
        </div>
      </div>

      <div *ngIf="loginError" class="alert alert-danger mb-3 d-flex align-items-center gap-2 animated-fadeInUp">
        <i class="bi bi-exclamation-triangle-fill"></i>
        <span>{{ loginError }}</span>
      </div>

      <button type="submit"
        class="btn btn-primary btn-lg w-100 d-flex align-items-center justify-content-center gap-2 animated-btn login-btn-gradient"
        [ngClass]="{'animated-pop': animacionBoton}" [disabled]="formularioLogin.invalid || bloqueoActivo || loading">
        <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
        <i class="bi bi-box-arrow-in-right"></i> Entrar
      </button>
    </form>
  </div>
</div>