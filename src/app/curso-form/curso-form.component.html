<!DOCTYPE html>
<html>
<head>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
</head>

<div class="container py-4">
  <!-- Botón volver -->
  <div class="mb-3">
    <button class="btn btn-outline-secondary" (click)="volverAlCurso()">
      <i class="bi bi-arrow-left me-2"></i>Volver al curso
    </button>
  </div>

  <!-- Contenido principal -->
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="card shadow border-0">
        <div class="card-header bg-primary text-white">
          <h3 class="mb-0">
            <i [class]="tipo === 'lectura' ? 'bi bi-book me-2' : 'bi bi-question-circle me-2'"></i>
            {{ titulo }}
          </h3>
          <p class="mb-0 opacity-75">{{ descripcion }}</p>
        </div>
        
        <div class="card-body">
          <!-- ACTIVIDAD DE LECTURA -->
          <div *ngIf="tipo === 'lectura'" class="lectura-content">
            <div [innerHTML]="actividad?.contenido" class="content-html"></div>
            <div class="text-center mt-4">
              <button class="btn btn-success btn-lg" (click)="volverAlCurso()">
                <i class="bi bi-check-circle me-2"></i>Completar Lectura
              </button>
            </div>
          </div>

          <!-- ACTIVIDAD DE PREGUNTAS -->
          <div *ngIf="tipo === 'preguntas' && actividad && actividad.preguntas && actividad.preguntas.length && !mostrarResultados">
            <div class="mb-4">
              <div class="progress">
                <div class="progress-bar bg-info" role="progressbar" 
                     [style.width.%]="getProgreso()">
                </div>
              </div>
              <small class="text-muted">
                {{ getRespuestasCompletadas() }} de {{ totalPreguntas }} preguntas respondidas
              </small>
            </div>

            <div *ngFor="let pregunta of actividad!.preguntas; let i = index" class="mb-4">
              <div class="card border-start border-primary border-3">
                <div class="card-body">
                  <div class="d-flex align-items-start">
                    <span class="badge bg-primary me-3 mt-1">{{ i + 1 }}</span>
                    <div class="flex-grow-1">
                      <h6 class="fw-bold mb-3">{{ pregunta.pregunta }}</h6>
                      <div class="options">
                        <div *ngFor="let opcion of pregunta.opciones; let j = index" 
                             class="form-check mb-2">
                          <input class="form-check-input" 
                                 type="radio" 
                                 [name]="'pregunta' + i" 
                                 [id]="'opcion' + i + '-' + j"
                                 [checked]="respuestas[i] === j"
                                 (change)="seleccionarRespuesta(i, j)">
                          <label class="form-check-label" [for]="'opcion' + i + '-' + j">
                            {{ opcion }}
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="text-center mt-4">
              <button class="btn btn-primary btn-lg" 
                      (click)="finalizarActividad()"
                      [disabled]="getRespuestasCompletadas() < totalPreguntas">
                <i class="bi bi-check-square me-2"></i>Finalizar Evaluación
              </button>
            </div>
          </div>

          <!-- RESULTADOS -->
          <div *ngIf="mostrarResultados" class="resultados">
            <div class="text-center mb-4">
              <div [class]="esAprobado() ? 'alert alert-success' : 'alert alert-warning'">
                <i [class]="esAprobado() ? 'bi bi-check-circle-fill fs-1 text-success' : 'bi bi-exclamation-triangle-fill fs-1 text-warning'"></i>
                <h4 class="mt-2">
                  {{ esAprobado() ? '¡Excelente trabajo!' : '¡Sigue practicando!' }}
                </h4>
                <h5>Obtuviste {{ aciertos }} de {{ totalPreguntas }} respuestas correctas</h5>
                <div class="progress mt-3" style="height: 20px;">
                  <div class="progress-bar" 
                       [class]="esAprobado() ? 'bg-success' : 'bg-warning'"
                       [style.width.%]="getPorcentajeAciertos()">
                    {{ getPorcentajeAciertos() | number:'1.0-0' }}%
                  </div>
                </div>
              </div>
            </div>

            <!-- Mostrar respuestas detalladas -->
            <div class="mb-4">
              <h5>Revisión de respuestas:</h5>
              <div *ngFor="let pregunta of actividad!.preguntas; let i = index" class="card mb-3">
                <div class="card-body">
                  <div class="d-flex align-items-start">
                    <i [class]="respuestas[i] === pregunta.respuestaCorrecta ? 'bi bi-check-circle-fill text-success fs-4 me-3' : 'bi bi-x-circle-fill text-danger fs-4 me-3'"></i>
                    <div class="flex-grow-1">
                      <h6 class="fw-bold">{{ pregunta.pregunta }}</h6>
                      <p class="text-muted mb-2">
                        <strong>Tu respuesta:</strong> {{ pregunta.opciones[respuestas[i]] || 'Sin respuesta' }}
                      </p>
                      <p class="text-success mb-2">
                        <strong>Respuesta correcta:</strong> {{ pregunta.opciones[pregunta.respuestaCorrecta] }}
                      </p>
                      <div class="alert alert-light">
                        <small><strong>Explicación:</strong> {{ pregunta.explicacion }}</small>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="text-center">
              <button class="btn btn-outline-primary me-3" (click)="reiniciarActividad()">
                <i class="bi bi-arrow-clockwise me-2"></i>Intentar de nuevo
              </button>
              <button class="btn btn-success" (click)="volverAlCurso()">
                <i class="bi bi-house me-2"></i>Volver al curso
              </button>
            </div>
          </div>

          <!-- TIPO NO SOPORTADO -->
          <div *ngIf="tipo !== 'lectura' && tipo !== 'preguntas'">
            <div class="alert alert-info">
              <i class="bi bi-info-circle me-2"></i>
              Este tipo de actividad aún no tiene una vista específica.<br>
              <span class="fw-bold">Tipo:</span> {{ tipo }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.content-html h2 {
  color: #0d6efd;
  margin-top: 1.5rem;
}

.content-html h3 {
  color: #6f42c1;
  margin-top: 1rem;
}

.content-html ul {
  margin-left: 1rem;
}

.content-html li {
  margin-bottom: 0.5rem;
}

.options .form-check-label {
  cursor: pointer;
}

.options .form-check-input:checked + label {
  font-weight: 600;
  color: #0d6efd;
}
</style>
